<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BIOLOGY SMART-HUB 2.0</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }

    /* –î—Ä—É–∫ */
    @media print {
      .no-print { display: none !important; }
      body { background: #fff !important; color: #111827 !important; }
      #printArea { display: block !important; }
    }

    /* –ú–∞–∫–µ—Ç "–¥—Ä—É–∫–æ–≤–∞–Ω–æ–≥–æ" –∞—Ä–∫—É—à–∞ */
    .paper {
      background: #ffffff;
      color: #111827;
      border: 1px solid #e5e7eb;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow: hidden;
    }
    .paper-header {
      padding: 18px 18px 10px 18px;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(180deg, #fff 0%, #fafafa 100%);
    }
    .paper-title {
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 18px;
      line-height: 1.2;
    }
    .paper-sub {
      margin-top: 6px;
      color: #6b7280;
      font-size: 12px;
    }

    /* "–ó–æ—à–∏—Ç–Ω–∏–π" —Ñ–æ–Ω –∑ –ª—ñ–Ω—ñ—è–º–∏ */
    .lined {
      position: relative;
      background:
        repeating-linear-gradient(
          to bottom,
          #ffffff 0px,
          #ffffff 26px,
          #eef2ff 27px
        );
    }
    /* –õ—ñ–≤–µ –ø–æ–ª–µ, —è–∫ —É –∑–æ—à–∏—Ç—ñ */
    .lined::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 46px;
      height: 100%;
      background: linear-gradient(90deg, rgba(244,63,94,.10), rgba(244,63,94,0));
      border-right: 2px solid rgba(244,63,94,.35);
      pointer-events: none;
    }

    /* –ë–ª–æ–∫–∏ —è–∫ "–ø–æ–ª—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è" */
    .field-label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .08em;
    }
    .field {
      background: rgba(255,255,255,.75);
      border: 1px dashed #cbd5e1;
      border-radius: 14px;
      padding: 12px;
    }

    /* –ü–æ–ª—è –≤–≤–æ–¥—É –≤ —Å—Ç–∏–ª—ñ "–±–ª–∞–Ω–∫—É" */
    .paper input, .paper textarea, .paper select {
      background: rgba(255,255,255,.9) !important;
      color: #111827 !important;
      border: 1px solid #d1d5db !important;
      border-radius: 12px !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≤ "–ø–∞–ø–µ—Ä–æ–≤–æ–º—É" —Ä–µ–∂–∏–º—ñ */
    .btn-paper {
      background: #111827;
      color: #fff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
    }
    .btn-paper:hover { background: #0b1220; }

    /* –ù–∏–∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ */
    .paper-footer {
      padding: 12px 18px;
      border-top: 1px solid #e5e7eb;
      background: #fafafa;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-size: 12px;
      color: #6b7280;
    }
  </style>
</head>

<body class="bg-slate-950 text-slate-100">
  <div id="app" class="min-h-screen"></div>
  <section id="printArea" class="hidden"></section>

  <script>
    // -------------------------
    // 0) –î–∞–Ω—ñ
    // -------------------------
    const OPP_LIST = [
      "–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ —ñ –ø–µ—Ä–µ—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ü—ñ—ó —Ä–æ—Å–ª–∏–Ω–Ω–∏—Ü—Ç–≤–∞",
      "–ó–µ–º–ª–µ–≤–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è",
      "–ó–µ–ª–µ–Ω–µ –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ —ñ —Å–∞–¥–æ–≤–æ-–ø–∞—Ä–∫–æ–≤–µ –≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤–æ",
      "–§—ñ–Ω–∞–Ω—Å–∏ —ñ –∫—Ä–µ–¥–∏—Ç",
      "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å—å–∫–∏–π –æ–±–ª—ñ–∫",
      "–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞",
      "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä—ñ—è"
    ];

    // –í–ê–ñ–õ–ò–í–û:
    // - presentation: —Å—é–¥–∏ –ø—ñ–¥—Å—Ç–∞–≤–∏—à —Ä–µ–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (Google Slides/PDF)
    // - notebook: –ª–∏—à–∞—î–º–æ NotebookLM (–∞–±–æ –º–æ–∂–µ—à —Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –±–ª–æ–∫–Ω–æ—Ç–∏ –Ω–∞ –º–æ–¥—É–ª—å, —è–∫—â–æ –±—É–¥—É—Ç—å)
    const NOTEBOOK_LM = "https://notebooklm.google.com/";

    const MODULES = [
      {
        id:"m1",
        title:"–ú–æ–¥—É–ª—å 1. –í—Å—Ç—É–ø –¥–æ –±—ñ–æ–ª–æ–≥—ñ—ó. –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∂–∏–≤–æ–≥–æ —Ç–∞ –º–µ—Ç–æ–¥–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è",
        presentation:"https://example.com/biology-smart-hub/presentations/m1",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m2",
        title:"–ú–æ–¥—É–ª—å 2. –ö–ª—ñ—Ç–∏–Ω–∞ ‚Äì —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –∂–∏–≤–æ–≥–æ. –ü–æ–¥—ñ–ª –∫–ª—ñ—Ç–∏–Ω",
        presentation:"https://example.com/biology-smart-hub/presentations/m2",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m3",
        title:"–ú–æ–¥—É–ª—å 3. –•—ñ–º—ñ—á–Ω–∏–π —Å–∫–ª–∞–¥ –∫–ª—ñ—Ç–∏–Ω–∏. –§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ —ñ –∫–ª—ñ—Ç–∏–Ω–Ω–µ –¥–∏—Ö–∞–Ω–Ω—è",
        presentation:"https://example.com/biology-smart-hub/presentations/m3",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m4",
        title:"–ú–æ–¥—É–ª—å 4. –û–¥–Ω–æ–∫–ª—ñ—Ç–∏–Ω–Ω—ñ –æ—Ä–≥–∞–Ω—ñ–∑–º–∏ —Ç–∞ –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ –±–∞–≥–∞—Ç–æ–∫–ª—ñ—Ç–∏–Ω–Ω–æ—Å—Ç—ñ",
        presentation:"https://example.com/biology-smart-hub/presentations/m4",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m5",
        title:"–ú–æ–¥—É–ª—å 5. –†–æ—Å–ª–∏–Ω–∞ —è–∫ —Ü—ñ–ª—ñ—Å–Ω–∏–π –æ—Ä–≥–∞–Ω—ñ–∑–º. –¢–∫–∞–Ω–∏–Ω–∏ —Ä–æ—Å–ª–∏–Ω",
        presentation:"https://example.com/biology-smart-hub/presentations/m5",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m6",
        title:"–ú–æ–¥—É–ª—å 6. –ö–æ—Ä—ñ–Ω—å ‚Äì –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω–∏–π –æ—Ä–≥–∞–Ω —Ä–æ—Å–ª–∏–Ω–∏. –ë—É–¥–æ–≤–∞ —ñ –≤–∏–¥–æ–∑–º—ñ–Ω–∏",
        presentation:"https://example.com/biology-smart-hub/presentations/m6",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m7",
        title:"–ú–æ–¥—É–ª—å 7. –ü–∞–≥—ñ–Ω: –±—É–¥–æ–≤–∞, —Ä–æ–∑–≤–∏—Ç–æ–∫ —ñ –≤–∏–¥–æ–∑–º—ñ–Ω–∏",
        presentation:"https://example.com/biology-smart-hub/presentations/m7",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m8",
        title:"–ú–æ–¥—É–ª—å 8. –õ–∏—Å—Ç–æ–∫. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ä–µ—á–æ–≤–∏–Ω —ñ —Ä—É—Ö–∏ —Ä–æ—Å–ª–∏–Ω",
        presentation:"https://example.com/biology-smart-hub/presentations/m8",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m9",
        title:"–ú–æ–¥—É–ª—å 9. –ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ñ –æ—Ä–≥–∞–Ω–∏ —Ä–æ—Å–ª–∏–Ω: –∫–≤—ñ—Ç–∫–∞, –Ω–∞—Å—ñ–Ω–∏–Ω–∞, –ø–ª—ñ–¥. –ó–∞–ø–∏–ª–µ–Ω–Ω—è —ñ –∑–∞–ø–ª—ñ–¥–Ω–µ–Ω–Ω—è",
        presentation:"https://example.com/biology-smart-hub/presentations/m9",
        notebook: NOTEBOOK_LM
      },
      {
        id:"m10",
        title:"–ú–æ–¥—É–ª—å 10. –†–æ–∑–º–Ω–æ–∂–µ–Ω–Ω—è —Ä–æ—Å–ª–∏–Ω: —Å—Ç–∞—Ç–µ–≤–µ, –Ω–µ—Å—Ç–∞—Ç–µ–≤–µ —ñ –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω–µ",
        presentation:"https://example.com/biology-smart-hub/presentations/m10",
        notebook: NOTEBOOK_LM
      }
    ];

    // -------------------------
    // 1) –°—Ç–∞–Ω (localStorage)
    // -------------------------
    const KEY = "biology_smart_hub_v2_state";
    const defaultState = () => ({
      profile: { studentName:"", specialty:"", opp: OPP_LIST[0] },
      progress: {},   // { m1: {done:true, date:"YYYY-MM-DD", score: 12} }
      notes: {},      // { m1: "..." }
      promptNotes: {} // { "m1|–û–ü–ü": "..." }
    });

    function loadState() {
      try {
        const raw = localStorage.getItem(KEY);
        return raw ? JSON.parse(raw) : defaultState();
      } catch {
        return defaultState();
      }
    }
    function saveState() {
      localStorage.setItem(KEY, JSON.stringify(state));
    }
    let state = loadState();

    // -------------------------
    // 2) –ü—Ä–æ–º–ø—Ç–∏ (–ú–æ–¥—É–ª—å √ó –û–ü–ü)
    // -------------------------
    function promptExplain(moduleTitle, opp) {
      return `–ü–æ—è—Å–Ω–∏ —Ç–µ–º—É "${moduleTitle}" –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –û–ü–ü "${opp}".
–î–∞–π 3 –ø—Ä–∏–∫–ª–∞–¥–∏ —Å–∞–º–µ –∑ –∞–≥—Ä–∞—Ä–Ω–æ—ó —Å—Ñ–µ—Ä–∏/–≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞.
–ù–∞–ø—Ä–∏–∫—ñ–Ω—Ü—ñ - 5 –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Ç–∞–Ω—å —ñ –∫–æ—Ä–æ—Ç–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.`;
    }

    function promptPracticeCase(moduleTitle, opp) {
      return `–°—Ç–≤–æ—Ä–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–π –∫–µ–π—Å –¥–æ —Ç–µ–º–∏ "${moduleTitle}" –¥–ª—è –û–ü–ü "${opp}".
1) –°–∏—Ç—É–∞—Ü—ñ—è (—Ä–µ–∞–ª—å–Ω–∞ –∞–±–æ –¥—É–∂–µ –ø—Ä–∞–≤–¥–æ–ø–æ–¥—ñ–±–Ω–∞ –¥–ª—è –∞–≥—Ä–∞—Ä–Ω–æ—ó —Å—Ñ–µ—Ä–∏)
2) –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (—â–æ –≤—ñ–¥–æ–º–æ)
3) –ó–∞–≤–¥–∞–Ω–Ω—è (5 –ø—É–Ω–∫—Ç—ñ–≤)
4) –ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –Ω–∞ 12 –±–∞–ª—ñ–≤ (—â–æ –Ω–∞ 4/8/12)
5) –ó—Ä–∞–∑–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.`;
    }

    function promptFlashcards(moduleTitle, opp) {
      return `–ó—Ä–æ–±–∏ 20 –∫–∞—Ä—Ç–æ–∫ –¥–æ —Ç–µ–º–∏ "${moduleTitle}" –¥–ª—è –û–ü–ü "${opp}":
—Ç–µ—Ä–º—ñ–Ω - –ø—Ä–æ—Å—Ç–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è - –ø—Ä–∏–∫–ª–∞–¥ (1 —Ä—è–¥–æ–∫). –ë–µ–∑ –≤–æ–¥–∏.`;
    }

    function getPrompts(moduleId, opp) {
      const m = MODULES.find(x => x.id === moduleId);
      const title = m ? m.title : moduleId;
      return [
        { id:"p1", title:"–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ –ø—ñ–¥ –û–ü–ü", text: promptExplain(title, opp) },
        { id:"p2", title:"–ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –∫–µ–π—Å –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—ó –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏", text: promptPracticeCase(title, opp) },
        { id:"p3", title:"–ö–∞—Ä—Ç–∫–∏ —Ç–µ—Ä–º—ñ–Ω—ñ–≤ (–≥–ª–æ—Å–∞—Ä—ñ–π)", text: promptFlashcards(title, opp) }
      ];
    }

    // -------------------------
    // 3) –£—Ç–∏–ª—ñ—Ç–∏
    // -------------------------
    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function clampInt(v, min, max) {
      const n = parseInt(v, 10);
      if (Number.isNaN(n)) return null;
      return Math.max(min, Math.min(max, n));
    }
    function todayISO() { return new Date().toISOString().slice(0,10); }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        alert("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.");
      } catch {
        alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É.");
      }
    }

    // -------------------------
    // 4) UI helpers
    // -------------------------
    function layout(title, content) {
      return `
      <div class="no-print">
        <header class="border-b border-slate-800 bg-slate-950/70 backdrop-blur sticky top-0 z-50">
          <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-3">
            <div>
              <div class="text-xs text-slate-300">–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∞ —Ü–∏—Ñ—Ä–æ–≤–∞ –µ–∫–æ—Å–∏—Å—Ç–µ–º–∞</div>
              <h1 class="text-lg sm:text-xl font-bold">${escapeHtml(title)}</h1>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <a href="#/dashboard" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">–ü–∞–Ω–µ–ª—å</a>
              <a href="#/modules" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">–ú–æ–¥—É–ª—ñ</a>
              <a href="#/workbook" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">–ó–æ—à–∏—Ç</a>
              <a href="#/prompts" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">–ü—Ä–æ–º–ø—Ç–∏</a>
              <a href="#/export" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-sm font-semibold">–ï–∫—Å–ø–æ—Ä—Ç</a>
            </div>
          </div>
        </header>
      </div>

      <main class="max-w-6xl mx-auto px-4 py-6">
        ${content}
      </main>
      `;
    }

    function card(title, body, footer="") {
      return `
      <section class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 shadow">
        <h3 class="font-semibold text-base">${escapeHtml(title)}</h3>
        <div class="mt-2 text-slate-200 text-sm leading-relaxed">${body}</div>
        ${footer ? `<div class="mt-3 pt-3 border-t border-slate-800 text-sm">${footer}</div>` : ""}
      </section>`;
    }

    function progressSummary() {
      const total = MODULES.length;
      const done = MODULES.filter(m => state.progress[m.id]?.done).length;
      const pct = Math.round((done / Math.max(total,1)) * 100);
      return { total, done, pct };
    }

    // -------------------------
    // 5) Pages
    // -------------------------
    function dashboardPage() {
      const p = progressSummary();

      const profileBody = `
        <label class="block mt-2">–ü–Ü–ë
          <input id="studentName" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2"
                 value="${escapeHtml(state.profile.studentName)}" placeholder="–ù–∞–ø—Ä., –Ü–≤–∞–Ω–µ–Ω–∫–æ –Ü–≤–∞–Ω" />
        </label>
        <label class="block mt-3">–ú–æ—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—å
          <input id="specialty" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2"
                 value="${escapeHtml(state.profile.specialty)}" placeholder="–ó–∞ –ø–æ—Ç—Ä–µ–±–∏" />
        </label>
        <label class="block mt-3">–û–ü–ü
          <select id="opp" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2">
            ${OPP_LIST.map(o => `<option ${state.profile.opp===o?"selected":""}>${escapeHtml(o)}</option>`).join("")}
          </select>
        </label>
      `;

      const progBody = `
        <div class="text-3xl font-bold">${p.pct}%</div>
        <div class="mt-2 text-slate-300">–í–∏–∫–æ–Ω–∞–Ω–æ –º–æ–¥—É–ª—ñ–≤: <b>${p.done}</b> –∑ <b>${p.total}</b></div>
        <div class="mt-3 h-3 rounded-full bg-slate-800 overflow-hidden">
          <div class="h-3 bg-emerald-600" style="width:${p.pct}%"></div>
        </div>
      `;

      const ideaBody = `
        –£ –∫–æ–∂–Ω–æ–º—É –º–æ–¥—É–ª—ñ –∑—ñ–±—Ä–∞–Ω–æ: –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—é, NotebookLM, —Ü–∏—Ñ—Ä–æ–≤–∏–π –∑–æ—à–∏—Ç —É "–¥—Ä—É–∫–æ–≤–∞–Ω–æ–º—É" —Ñ–æ—Ä–º–∞—Ç—ñ —Ç–∞ –ø—Ä–æ–º–ø—Ç–∏ –®–Ü –≤ —Ä–æ–∑—Ä—ñ–∑—ñ –û–ü–ü.
        –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ - –±–µ–∑ —Å–µ—Ä–≤–µ—Ä—ñ–≤ —ñ –±–µ–∑ —Ä–∏–∑–∏–∫—É "–∑–Ω–∏–∫–ª–æ –¥–µ—Å—å —É —Ö–º–∞—Ä—ñ".
      `;

      const html = layout("BIOLOGY SMART-HUB 2.0", `
        <div class="grid md:grid-cols-2 gap-4">
          ${card("–ü—Ä–æ—Ñ—ñ–ª—å", profileBody, `<button id="saveProfile" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 font-semibold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>`)}
          ${card("–ü—Ä–æ–≥—Ä–µ—Å", progBody, `<a class="underline" href="#/modules">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –º–æ–¥—É–ª—ñ–≤</a>`)}
        </div>
        <div class="mt-4">
          ${card("–ü—Ä–æ –µ–∫–æ—Å–∏—Å—Ç–µ–º—É (–∫–æ—Ä–æ—Ç–∫–æ)", ideaBody)}
        </div>
      `);

      mount(html);

      document.getElementById("saveProfile").addEventListener("click", () => {
        state.profile.studentName = document.getElementById("studentName").value.trim();
        state.profile.specialty = document.getElementById("specialty").value.trim();
        state.profile.opp = document.getElementById("opp").value;
        saveState();
        alert("–ó–±–µ—Ä–µ–∂–µ–Ω–æ.");
      });
    }

    function modulesPage() {
      const list = MODULES.map(m => {
        const prog = state.progress[m.id] || { done:false, score:null, date:"" };
        const badge = prog.done
          ? `<span class="text-xs px-2 py-1 rounded bg-emerald-700">–≤–∏–∫–æ–Ω–∞–Ω–æ</span>`
          : `<span class="text-xs px-2 py-1 rounded bg-slate-700">—É —Ä–æ–±–æ—Ç—ñ</span>`;

        const links = `
          <div class="flex flex-wrap items-center gap-2 mt-2">
            <a class="underline" href="#/workbook?m=${m.id}">–ó–æ—à–∏—Ç</a>
            <a class="underline" href="#/prompts?m=${m.id}">–ü—Ä–æ–º–ø—Ç–∏</a>
            <a class="underline" href="${m.presentation}" target="_blank" rel="noopener">–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—è</a>
            <a class="underline" href="${m.notebook}" target="_blank" rel="noopener">NotebookLM</a>
          </div>
        `;

        return card(
          m.title,
          `
          <div class="flex flex-wrap items-center gap-2 mt-2">
            ${badge}
            <span class="text-slate-300 text-xs">–î–∞—Ç–∞: ${escapeHtml(prog.date || "‚Äî")} ¬∑ –û—Ü—ñ–Ω–∫–∞: ${prog.score ?? "‚Äî"}</span>
          </div>
          ${links}
          `,
          `
          <div class="flex flex-wrap items-center gap-2">
            <button data-done="${m.id}" class="px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700">
              –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
            </button>
          </div>
          `
        );
      }).join("");

      mount(layout("–ú–æ–¥—É–ª—ñ", `<div class="space-y-4">${list}</div>`));

      document.querySelectorAll("button[data-done]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-done");
          const date = prompt("–î–∞—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (YYYY-MM-DD):", state.progress[id]?.date || todayISO()) || "";
          const scoreRaw = prompt("–û—Ü—ñ–Ω–∫–∞ (1-12), –º–æ–∂–Ω–∞ –ø–æ—Ä–æ–∂–Ω—å–æ:", state.progress[id]?.score ?? "") || "";
          const score = scoreRaw.trim() ? clampInt(scoreRaw, 1, 12) : null;

          state.progress[id] = { done:true, date: date.trim(), score };
          saveState();
          modulesPage();
        });
      });
    }

    function workbookPage() {
      const params = new URLSearchParams((location.hash.split("?")[1] || ""));
      const mid = params.get("m") || MODULES[0].id;
      const module = MODULES.find(x => x.id === mid) || MODULES[0];

      const prog = state.progress[module.id] || { done:false, score:null, date:"" };
      const note = state.notes[module.id] || "";

      const body = `
        <div class="paper">
          <div class="paper-header">
            <div class="paper-title">–¶–∏—Ñ—Ä–æ–≤–∏–π —Ä–æ–±–æ—á–∏–π –∑–æ—à–∏—Ç (—Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–∫–æ–≤–∞–Ω–æ–≥–æ)</div>
            <div class="paper-sub">${escapeHtml(module.title)}</div>
          </div>

          <div class="lined p-5 sm:p-6">
            <div class="grid lg:grid-cols-2 gap-4">
              <div class="field">
                <div class="field-label">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –º–æ–¥—É–ª—è</div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <a href="${module.presentation}" target="_blank" rel="noopener"
                    class="px-3 py-2 rounded-lg bg-blue-700 hover:bg-blue-600 text-white text-sm">
                    üìë –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—è
                  </a>
                  <a href="${module.notebook}" target="_blank" rel="noopener"
                    class="px-3 py-2 rounded-lg bg-purple-700 hover:bg-purple-600 text-white text-sm">
                    üß† NotebookLM
                  </a>
                </div>

                <div class="mt-3 text-sm text-slate-700">
                  –ó–∞–ø–∏—Å—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —è–∫ —É –ø–∞–ø–µ—Ä–æ–≤–æ–º—É –∑–æ—à–∏—Ç—ñ: —Ñ–∞–∫—Ç - —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è - –≤–∏—Å–Ω–æ–≤–æ–∫.
                </div>
              </div>

              <div class="field">
                <div class="field-label">–î–∞–Ω—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</div>
                <label class="block mt-2 text-sm">
                  –î–∞—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
                  <input id="dateDone" type="date" class="mt-1 w-full p-2"
                    value="${escapeHtml(prog.date || "")}">
                </label>

                <label class="block mt-3 text-sm">
                  –û—Ü—ñ–Ω–∫–∞ (1-12)
                  <input id="score" type="number" min="1" max="12" class="mt-1 w-full p-2"
                    value="${prog.score ?? ""}" placeholder="1-12">
                </label>

                <div class="mt-3 text-sm text-slate-700">
                  –ó–∞ –ø–æ—Ç—Ä–µ–±–∏: –≤—ñ–¥–∫—Ä–∏–π—Ç–µ ‚Äú–ü—Ä–æ–º–ø—Ç–∏‚Äù - —ñ —Å—Ñ–æ—Ä–º—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—ñ–¥ —Å–≤–æ—é –û–ü–ü.
                </div>
              </div>
            </div>

            <div class="field mt-4">
              <div class="field-label">–ú–æ—ó –∑–∞–ø–∏—Å–∏ / —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ / –≤–∏—Å–Ω–æ–≤–∫–∏</div>
              <textarea id="note" rows="10" class="mt-2 w-full p-3"
                placeholder="1) –©–æ –∑—Ä–æ–±–ª–µ–Ω–æ (–ø—Ä–∞–∫—Ç–∏—á–Ω–∞ –¥—ñ—è)\n2) –©–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞–ª–∏/–≤–∏–º—ñ—Ä—è–ª–∏\n3) –í–∏—Å–Ω–æ–≤–æ–∫ (1-2 —Ä–µ—á–µ–Ω–Ω—è)">${escapeHtml(note)}</textarea>

              <div class="mt-3 flex flex-wrap gap-2">
                <button id="saveNote" class="btn-paper">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button id="markDone" class="px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-900 font-semibold">
                  –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ
                </button>
                <a class="px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-900 font-semibold"
                   href="#/prompts?m=${module.id}">
                  –ü—Ä–æ–º–ø—Ç–∏
                </a>
              </div>
            </div>

            <div class="field mt-4">
              <div class="field-label">–ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤</div>
              <div class="mt-2 flex flex-wrap gap-2">
                ${MODULES.map(m => `
                  <a class="px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-900 font-semibold ${m.id===module.id ? "ring-2 ring-slate-900" : ""}"
                     href="#/workbook?m=${m.id}">
                    ${escapeHtml(m.id.toUpperCase())}
                  </a>`).join("")}
              </div>
            </div>
          </div>

          <div class="paper-footer">
            <div>BIOLOGY SMART-HUB 2.0 - —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–∫–æ–≤–∞–Ω–æ–≥–æ –∑–æ—à–∏—Ç–∞</div>
            <div>–ú–æ–¥—É–ª—å: ${escapeHtml(module.id.toUpperCase())}</div>
          </div>
        </div>
      `;

      mount(layout("–¶–∏—Ñ—Ä–æ–≤–∏–π –∑–æ—à–∏—Ç", body));

      document.getElementById("saveNote").addEventListener("click", () => {
        const date = document.getElementById("dateDone").value;
        const scoreRaw = document.getElementById("score").value.trim();
        const noteText = document.getElementById("note").value;

        state.notes[module.id] = noteText;
        state.progress[module.id] = {
          ...(state.progress[module.id] || {}),
          date: date || (state.progress[module.id]?.date || ""),
          score: scoreRaw ? clampInt(scoreRaw, 1, 12) : null
        };
        saveState();
        alert("–ó–±–µ—Ä–µ–∂–µ–Ω–æ.");
      });

      document.getElementById("markDone").addEventListener("click", () => {
        state.progress[module.id] = {
          ...(state.progress[module.id] || {}),
          done: true,
          date: state.progress[module.id]?.date || todayISO()
        };
        saveState();
        alert("–ü–æ–∑–Ω–∞—á–µ–Ω–æ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ.");
      });
    }

    function promptsPage() {
      const params = new URLSearchParams((location.hash.split("?")[1] || ""));
      const mid = params.get("m") || MODULES[0].id;

      const moduleOptions = MODULES.map(m => `<option value="${m.id}" ${m.id===mid?"selected":""}>${escapeHtml(m.title)}</option>`).join("");
      const oppOptions = OPP_LIST.map(o => `<option ${state.profile.opp===o?"selected":""}>${escapeHtml(o)}</option>`).join("");

      const prompts = getPrompts(mid, state.profile.opp);
      const key = `${mid}|${state.profile.opp}`;
      const pn = state.promptNotes[key] || "";

      const body = `
        ${card("–í–∏–±—ñ—Ä (–ú–æ–¥—É–ª—å √ó –û–ü–ü)", `
          <div class="grid md:grid-cols-2 gap-3">
            <label class="block">–ú–æ–¥—É–ª—å
              <select id="promptModule" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2">
                ${moduleOptions}
              </select>
            </label>
            <label class="block">–û–ü–ü
              <select id="promptOpp" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2">
                ${oppOptions}
              </select>
            </label>
          </div>
          <div class="mt-3 text-xs text-slate-300">
            –ü—Ä–æ–º–ø—Ç–∏ —Ñ–æ—Ä–º—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥ —Ç–µ–º—É —Ç–∞ –û–ü–ü. –î–∞–ª—ñ - –∫–æ–ø—ñ—é—î—Ç–µ –π –ø—Ä–∞—Ü—é—î—Ç–µ.
          </div>
        `)}

        <div class="space-y-4">
          ${prompts.map(p => card(p.title,
            `<pre class="whitespace-pre-wrap text-sm leading-relaxed">${escapeHtml(p.text)}</pre>`,
            `<button data-copy="${escapeHtml(p.id)}" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 font-semibold">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç</button>`
          )).join("")}
        </div>

        ${card("–ú–æ—ó –Ω–æ—Ç–∞—Ç–∫–∏ –ø—ñ—Å–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –®–Ü", `
          <textarea id="promptNote" rows="6" class="mt-1 w-full rounded-lg bg-slate-950 border border-slate-800 p-2"
            placeholder="–©–æ –∫–æ—Ä–∏—Å–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–ª–∏? –©–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —É –∑–æ—à–∏—Ç?">${escapeHtml(pn)}</textarea>
          <div class="mt-3 flex gap-2">
            <button id="savePromptNote" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700">–ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–æ—Ç–∞—Ç–∫—É</button>
          </div>
        `)}
      `;

      mount(layout("–ü—Ä–æ–º–ø—Ç–∏", body));

      document.getElementById("promptModule").addEventListener("change", (e) => {
        location.hash = `#/prompts?m=${e.target.value}`;
      });

      document.getElementById("promptOpp").addEventListener("change", (e) => {
        state.profile.opp = e.target.value;
        saveState();
        promptsPage();
      });

      document.querySelectorAll("button[data-copy]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-copy");
          const p = prompts.find(x => x.id === id);
          if (p) copyText(p.text);
        });
      });

      document.getElementById("savePromptNote").addEventListener("click", () => {
        state.promptNotes[key] = document.getElementById("promptNote").value;
        saveState();
        alert("–ó–±–µ—Ä–µ–∂–µ–Ω–æ.");
      });
    }

    function exportPage() {
      const profile = state.profile;

      const rows = MODULES.map(m => {
        const p = state.progress[m.id] || {};
        return `
          <tr class="border-b">
            <td class="py-2 pr-3">${escapeHtml(m.title)}</td>
            <td class="py-2 pr-3">${escapeHtml(p.date || "")}</td>
            <td class="py-2 pr-3">${p.score ?? ""}</td>
            <td class="py-2 pr-3">${p.done ? "–¢–∞–∫" : "–ù—ñ"}</td>
          </tr>`;
      }).join("");

      const body = `
        ${card("–ï–∫—Å–ø–æ—Ä—Ç —É PDF (Ctrl+P ‚Üí –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ PDF)", `
          –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É - —Å—Ñ–æ—Ä–º—É—î—Ç—å—Å—è "—á–∏—Å—Ç–∏–π" –∑–≤—ñ—Ç.
          <div class="mt-3">
            <button id="btnPrint" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 font-semibold">
              –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç —ñ –¥—Ä—É–∫—É–≤–∞—Ç–∏ (PDF)
            </button>
          </div>
        `)}
      `;

      mount(layout("–ï–∫—Å–ø–æ—Ä—Ç / –ó–≤—ñ—Ç", body));

      document.getElementById("btnPrint").addEventListener("click", () => {
        const printArea = document.getElementById("printArea");
        printArea.innerHTML = `
          <div class="p-8 text-slate-900">
            <h2 class="text-2xl font-bold">BIOLOGY SMART-HUB 2.0 ‚Äì –ó–≤—ñ—Ç (—Ü–∏—Ñ—Ä–æ–≤–∏–π –∑–æ—à–∏—Ç)</h2>
            <div class="mt-3">
              <div><b>–ü–Ü–ë:</b> ${escapeHtml(profile.studentName || "‚Äî")}</div>
              <div><b>–°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—å:</b> ${escapeHtml(profile.specialty || "‚Äî")}</div>
              <div><b>–û–ü–ü:</b> ${escapeHtml(profile.opp || "‚Äî")}</div>
            </div>

            <h3 class="mt-6 text-lg font-semibold">–ó–≤–µ–¥–µ–Ω—ñ –æ—Ü—ñ–Ω–∫–∏ –ø–æ –º–æ–¥—É–ª—è—Ö</h3>
            <table class="mt-2 w-full text-sm border-t">
              <thead>
                <tr class="border-b">
                  <th class="text-left py-2 pr-3">–ú–æ–¥—É–ª—å</th>
                  <th class="text-left py-2 pr-3">–î–∞—Ç–∞</th>
                  <th class="text-left py-2 pr-3">–û—Ü—ñ–Ω–∫–∞ (1-12)</th>
                  <th class="text-left py-2 pr-3">–í–∏–∫–æ–Ω–∞–Ω–æ</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>

            <div class="mt-6 text-xs text-slate-600">
              –î–∞–Ω—ñ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ –±—Ä–∞—É–∑–µ—Ä–∞ (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä—ñ–≤).
            </div>
          </div>
        `;
        printArea.classList.remove("hidden");
        window.print();
        printArea.classList.add("hidden");
        printArea.innerHTML = "";
      });
    }

    // -------------------------
    // 6) Router (hash)
    // -------------------------
    function mount(html) {
      document.getElementById("app").innerHTML = html;
    }

    function route() {
      const hash = location.hash || "#/dashboard";
      const path = hash.replace("#","").split("?")[0];

      if (path === "/dashboard") return dashboardPage();
      if (path === "/modules") return modulesPage();
      if (path === "/workbook") return workbookPage();
      if (path === "/prompts") return promptsPage();
      if (path === "/export") return exportPage();

      return dashboardPage();
    }

    window.addEventListener("hashchange", route);
    route();
  </script>
</body>
</html>
