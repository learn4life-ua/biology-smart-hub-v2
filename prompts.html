<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BIOLOGY SMART-HUB 2.0 - Промпти</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }

    @media print {
      .no-print { display: none !important; }
      body { background: #fff !important; color: #111827 !important; }
    }

    /* "Паперова" сторінка */
    .paper {
      background: #ffffff;
      color: #111827;
      border: 1px solid #e5e7eb;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow: hidden;
    }
    .paper-header {
      padding: 18px 18px 10px 18px;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(180deg, #fff 0%, #fafafa 100%);
    }
    .paper-title {
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 18px;
      line-height: 1.2;
    }
    .paper-sub {
      margin-top: 6px;
      color: #6b7280;
      font-size: 12px;
    }

    /* Лінійований фон (можна прибрати, якщо захочете) */
    .lined {
      position: relative;
      background:
        repeating-linear-gradient(
          to bottom,
          #ffffff 0px,
          #ffffff 26px,
          #eef2ff 27px
        );
    }
    .lined::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 46px;
      height: 100%;
      background: linear-gradient(90deg, rgba(244,63,94,.10), rgba(244,63,94,0));
      border-right: 2px solid rgba(244,63,94,.35);
      pointer-events: none;
    }

    /* Секції */
    .note-section {
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(148,163,184,.55);
      border-radius: 16px;
      padding: 12px;
    }
    .note-label {
      font-size: 12px;
      color: #334155;
      font-weight: 800;
      letter-spacing: .06em;
      text-transform: uppercase;
    }
    .note-hint {
      margin-top: 4px;
      color: #64748b;
      font-size: 12px;
      line-height: 1.35;
    }

    .paper textarea, .paper input, .paper select {
      background: rgba(255,255,255,.92) !important;
      color: #111827 !important;
      border: 1px solid rgba(148,163,184,.65) !important;
      border-radius: 14px !important;
      outline: none;
    }
    .paper textarea:focus, .paper input:focus, .paper select:focus {
      box-shadow: 0 0 0 3px rgba(59,130,246,.18);
      border-color: rgba(59,130,246,.65) !important;
    }

    .btn-paper {
      background: #111827;
      color: #fff;
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 800;
    }
    .btn-paper:hover { background: #0b1220; }

    .btn-light {
      border: 1px solid #cbd5e1;
      background: #fff;
      color: #0f172a;
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 800;
    }
    .btn-light:hover { background: #f8fafc; }

    textarea { font-size: 14px; line-height: 1.5; }
  </style>
</head>

<body class="bg-slate-950 text-slate-100">
  <div id="app" class="min-h-screen"></div>

  <script>
    // -------------------------
    // 0) Дані
    // -------------------------
    const OPP_LIST = [
      "Виробництво і переробка продукції рослинництва",
      "Землевпорядкування",
      "Зелене будівництво і садово-паркове господарство",
      "Фінанси і кредит",
      "Бухгалтерський облік",
      "Організація виробництва",
      "Ветеринарія"
    ];

    const MODULES = [
      { id:"m1",  title:"Модуль 1. Вступ до біології. Властивості живого та методи дослідження" },
      { id:"m2",  title:"Модуль 2. Клітина – структурно-функціональна одиниця живого. Поділ клітин" },
      { id:"m3",  title:"Модуль 3. Хімічний склад клітини. Фотосинтез і клітинне дихання" },
      { id:"m4",  title:"Модуль 4. Одноклітинні організми та перехід до багатоклітинності" },
      { id:"m5",  title:"Модуль 5. Рослина як цілісний організм. Тканини рослин" },
      { id:"m6",  title:"Модуль 6. Корінь – вегетативний орган рослини. Будова і видозміни" },
      { id:"m7",  title:"Модуль 7. Пагін: будова, розвиток і видозміни" },
      { id:"m8",  title:"Модуль 8. Листок. Транспорт речовин і рухи рослин" },
      { id:"m9",  title:"Модуль 9. Генеративні органи рослин: квітка, насінина, плід. Запилення і запліднення" },
      { id:"m10", title:"Модуль 10. Розмноження рослин: статеве, нестатеве і вегетативне" }
    ];

    // -------------------------
    // 1) Стан (localStorage)
    // -------------------------
    const KEY = "biology_smart_hub_v2_state";
    const defaultState = () => ({
      profile: { studentName:"", group:"", opp: OPP_LIST[0] },
      promptNotes: {} // { "m1|ОПП": "..." }
    });

    function loadState() {
      try {
        const raw = localStorage.getItem(KEY);
        const st = raw ? JSON.parse(raw) : defaultState();
        st.profile = st.profile || { studentName:"", group:"", opp: OPP_LIST[0] };
        st.promptNotes = st.promptNotes || {};
        if (!st.profile.opp) st.profile.opp = OPP_LIST[0];
        return st;
      } catch {
        return defaultState();
      }
    }
    function saveState() { localStorage.setItem(KEY, JSON.stringify(state)); }
    let state = loadState();

    // -------------------------
    // 2) Промпти (Модуль × ОПП) – як у вашому прикладі
    // -------------------------
    function promptExplain(moduleTitle, opp) {
      return `Поясни тему "${moduleTitle}" максимально прикладно для студента ОПП "${opp}". 
Дай 3 приклади з аграрної сфери/виробництва. 
Наприкінці - 5 контрольних запитань і короткі відповіді.`;
    }
    function promptPracticeCase(moduleTitle, opp) {
      return `Створи практичний кейс до теми "${moduleTitle}" для ОПП "${opp}".
1) Ситуація (реальна/правдоподібна для агросфери)
2) Вхідні дані
3) Завдання (5 пунктів)
4) Критерії оцінювання на 12 балів (4/8/12)
5) Зразок відповіді.`;
    }
    function promptFlashcards(moduleTitle, opp) {
      return `Зроби 20 карток до теми "${moduleTitle}" для ОПП "${opp}": 
термін - просте визначення - приклад (1 рядок). Без води.`;
    }

    function getPrompts(moduleId, opp) {
      const m = MODULES.find(x => x.id === moduleId);
      const title = m ? m.title : moduleId;
      return [
        { id:"p1", title:"Пояснення з прикладами під ОПП", text: promptExplain(title, opp) },
        { id:"p2", title:"Практичний кейс для практичної підготовки", text: promptPracticeCase(title, opp) },
        { id:"p3", title:"Картки термінів (глосарій)", text: promptFlashcards(title, opp) }
      ];
    }

    // -------------------------
    // 3) Утиліти
    // -------------------------
    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    async function copyText(text) {
      try { await navigator.clipboard.writeText(text); alert("Скопійовано."); }
      catch { alert("Не вдалося скопіювати. Спробуйте вручну."); }
    }

    // -------------------------
    // 4) UI helpers (як у вас)
    // -------------------------
    function layout(title, content) {
      return `
      <div class="no-print">
        <header class="border-b border-slate-800 bg-slate-950/70 backdrop-blur sticky top-0 z-50">
          <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-3">
            <div>
              <div class="text-xs text-slate-300">Інноваційна цифрова екосистема</div>
              <h1 class="text-lg sm:text-xl font-bold">${escapeHtml(title)}</h1>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <a href="./index.html" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">Головна</a>
              <a href="./prompts.html#/prompts" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">Промпти</a>
            </div>
          </div>
        </header>
      </div>

      <main class="max-w-6xl mx-auto px-4 py-6">
        ${content}
      </main>
      `;
    }

    function card(title, body, footer="") {
      return `
      <section class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 shadow">
        <h3 class="font-semibold text-base">${escapeHtml(title)}</h3>
        <div class="mt-2 text-slate-200 text-sm leading-relaxed">${body}</div>
        ${footer ? `<div class="mt-3 pt-3 border-t border-slate-800 text-sm">${footer}</div>` : ""}
      </section>`;
    }

    function mount(html) { document.getElementById("app").innerHTML = html; }

    // -------------------------
    // 5) Page: prompts (1:1 як у вашому прикладі, але “паперовий” блок для нотаток)
    // -------------------------
    function promptsPage() {
      const params = new URLSearchParams((location.hash.split("?")[1] || ""));
      const mid = params.get("m") || MODULES[0].id;

      const moduleOptions = MODULES
        .map(m => `<option value="${m.id}" ${m.id===mid?"selected":""}>${escapeHtml(m.title)}</option>`)
        .join("");

      const oppOptions = OPP_LIST
        .map(o => `<option ${state.profile.opp===o?"selected":""}>${escapeHtml(o)}</option>`)
        .join("");

      const prompts = getPrompts(mid, state.profile.opp);
      const key = `${mid}|${state.profile.opp}`;
      const pn = state.promptNotes[key] || "";

      const paper = `
        <div class="paper">
          <div class="paper-header">
            <div class="paper-title">Промпти для ШІ</div>
            <div class="paper-sub">
              Оберіть модуль і ОПП - копіюйте промпт - коротко занотовуйте результат.
            </div>
            <div class="mt-3 text-sm text-slate-700">
              <b>ПІБ:</b> ${escapeHtml(state.profile.studentName || "—")}
              &nbsp; · &nbsp; <b>Група:</b> ${escapeHtml(state.profile.group || "—")}
              &nbsp; · &nbsp; <b>ОПП:</b> ${escapeHtml(state.profile.opp || "—")}
            </div>
          </div>

          <div class="lined p-4 sm:p-6 space-y-4">
            <div class="note-section">
              <div class="note-label">Вибір (Модуль × ОПП)</div>
              <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="block text-sm">
                  Модуль
                  <select id="promptModule" class="mt-1 w-full p-2.5">
                    ${moduleOptions}
                  </select>
                </label>
                <label class="block text-sm">
                  ОПП
                  <select id="promptOpp" class="mt-1 w-full p-2.5">
                    ${oppOptions}
                  </select>
                </label>
              </div>
              <div class="note-hint">Порада: просіть ШІ відповідати структуровано - це легко переноситься в зошит.</div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
              ${prompts.map(p => `
                <div class="note-section">
                  <div class="note-label">${escapeHtml(p.title)}</div>
                  <div class="mt-2">
                    <pre class="whitespace-pre-wrap text-sm leading-relaxed text-slate-900 bg-white/70 border border-slate-300 rounded-xl p-3">${escapeHtml(p.text)}</pre>
                  </div>
                  <div class="mt-3 flex gap-2">
                    <button data-copy="${escapeHtml(p.id)}" class="btn-paper">Копіювати промпт</button>
                  </div>
                </div>
              `).join("")}
            </div>

            <div class="note-section">
              <div class="note-label">Нотатки після роботи з ШІ</div>
              <div class="note-hint">Запишіть тільки корисне: висновки, терміни, помилки, що виправили.</div>
              <textarea id="promptNote" rows="6" class="mt-2 w-full p-3"
                placeholder="Що корисного? Що перенести в зошит?">${escapeHtml(pn)}</textarea>
              <div class="mt-3 flex flex-wrap gap-2">
                <button id="savePromptNote" class="btn-light">Зберегти нотатки</button>
                <a href="./index.html#/workbook?m=${mid}" class="btn-light">Перейти в зошит цього модуля</a>
              </div>
            </div>
          </div>
        </div>
      `;

      const body = `
        ${card("Промпти (у стилі зошита)", paper)}
      `;

      mount(layout("Промпти", body));

      document.getElementById("promptModule").addEventListener("change", (e) => {
        location.hash = `#/prompts?m=${e.target.value}`;
      });

      document.getElementById("promptOpp").addEventListener("change", (e) => {
        state.profile.opp = e.target.value;
        saveState();
        promptsPage();
      });

      document.querySelectorAll("button[data-copy]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-copy");
          const p = prompts.find(x => x.id === id);
          if (p) copyText(p.text);
        });
      });

      document.getElementById("savePromptNote").addEventListener("click", () => {
        state.promptNotes[key] = document.getElementById("promptNote").value;
        saveState();
        alert("Збережено.");
      });
    }

    // -------------------------
    // 6) Router (мінімальний, тільки для prompts)
    // -------------------------
    function route() {
      const hash = location.hash || "#/prompts";
      const path = hash.replace("#","").split("?")[0];

      if (path === "/prompts") return promptsPage();
      return promptsPage();
    }

    window.addEventListener("hashchange", route);
    route();
  </script>
</body>
</html>
